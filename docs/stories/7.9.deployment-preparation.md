# Story 7.9: Prepare for Deployment

## Status

Draft

## Story

**As a** project manager,
**I want** deployment package ready,
**so that** plugin can be installed on production site

## Acceptance Criteria

1. Pre-launch checklist completed:
   - ✓ Code follows WordPress standards (PHPCS passing)
   - ✓ No PHP errors/warnings
   - ✓ Security review complete
   - ✓ All tests passing
   - ✓ Documentation complete
   - ✓ Plugin icon created (512x512)
   - ✓ Screenshots prepared (1200x900)
   - ✓ `readme.txt` formatted for WordPress.org (if publishing)
2. Distribution package created:
   - ZIP file with plugin directory
   - Excludes: `node_modules/`, `.git/`, `tests/`, source files
   - Includes: compiled assets, vendor dependencies
3. Deployment documentation:
   - Staging deployment steps
   - Production deployment steps
   - Rollback procedure
   - Post-deployment testing checklist
4. Version number set in main plugin file and package.json

## Tasks / Subtasks

- [ ] Task 1: Complete pre-launch checklist (AC: 1)
  - [ ] Verify PHPCS passing (composer run phpcs)
  - [ ] Verify no PHP errors/warnings (WP_DEBUG enabled)
  - [ ] Verify security audit complete (Story 7.4)
  - [ ] Verify all PHPUnit tests passing
  - [ ] Verify all Jest tests passing
  - [ ] Verify user documentation complete (Story 7.6)
  - [ ] Verify developer documentation complete
  - [ ] Verify performance benchmarks met (Story 7.5)
  - [ ] Verify final QA complete (Story 7.8)
  - [ ] Document checklist completion date

- [ ] Task 2: Create plugin icon (AC: 1)
  - [ ] Design 512x512 plugin icon (SVG or PNG)
  - [ ] Use brand colors and plugin theme
  - [ ] Create icon-256x256.png (retina)
  - [ ] Create icon-128x128.png (standard)
  - [ ] Save icons in plugin root directory
  - [ ] Test icon displays in WordPress admin
  - [ ] Document icon design guidelines

- [ ] Task 3: Prepare screenshots (AC: 1)
  - [ ] Capture 1200x900 screenshot 1: Main plugin page (page editor)
  - [ ] Capture 1200x900 screenshot 2: Generate all blocks progress modal
  - [ ] Capture 1200x900 screenshot 3: Image library with tags
  - [ ] Capture 1200x900 screenshot 4: Settings page
  - [ ] Capture 1200x900 screenshot 5: Analytics dashboard
  - [ ] Capture 1200x900 screenshot 6: CSV import interface
  - [ ] Save as screenshot-1.png through screenshot-6.png
  - [ ] Optimize images for file size (use TinyPNG)
  - [ ] Place screenshots in plugin root or assets/

- [ ] Task 4: Create/update readme.txt for WordPress.org (AC: 1)
  - [ ] Write plugin name and short description
  - [ ] List contributors and author
  - [ ] Set tags (seo, content-generator, ai, openai, acf)
  - [ ] Set requires at least (6.0), tested up to (6.4), requires PHP (8.0)
  - [ ] Write full description with features
  - [ ] Write installation instructions
  - [ ] Write FAQ section
  - [ ] Write changelog (version 1.0.0)
  - [ ] Add screenshot descriptions
  - [ ] Validate with WordPress.org readme validator
  - [ ] Test rendering with readme.txt parser

- [ ] Task 5: Set version numbers (AC: 4)
  - [ ] Update main plugin file header (Version: 1.0.0)
  - [ ] Update package.json version (1.0.0)
  - [ ] Update composer.json version (1.0.0)
  - [ ] Update readme.txt stable tag (1.0.0)
  - [ ] Add version constant in plugin class
  - [ ] Verify version consistency across all files
  - [ ] Commit version bump with "Release v1.0.0" message

- [ ] Task 6: Create build/deployment script (AC: 2)
  - [ ] Create build.sh or build script in package.json
  - [ ] Script runs composer install --no-dev
  - [ ] Script runs npm run build
  - [ ] Script creates clean dist/ directory
  - [ ] Script copies files to dist/ (excluding dev files)
  - [ ] Script creates ZIP archive (content-generator-1.0.0.zip)
  - [ ] Test build script on clean repository
  - [ ] Document build script usage

- [ ] Task 7: Create .distignore file (AC: 2)
  - [ ] Add .git to ignore list
  - [ ] Add .github to ignore list
  - [ ] Add node_modules to ignore list
  - [ ] Add tests to ignore list
  - [ ] Add .editorconfig, .eslintrc.js, .phpcs.xml.dist
  - [ ] Add package.json, package-lock.json, composer.json, composer.lock
  - [ ] Add webpack.config.js
  - [ ] Add src/ directory (only include build/)
  - [ ] Add .env, .env.example
  - [ ] Test with build script

- [ ] Task 8: Create distribution ZIP package (AC: 2)
  - [ ] Run build script to generate clean dist/
  - [ ] Verify compiled assets included (assets/js/build/, assets/css/)
  - [ ] Verify vendor/ included with production dependencies
  - [ ] Verify ACF JSON included (acf-json/)
  - [ ] Verify templates included
  - [ ] Verify languages folder included
  - [ ] Verify no source files or dev dependencies
  - [ ] Create ZIP: content-generator-1.0.0.zip
  - [ ] Test ZIP on fresh WordPress install
  - [ ] Verify ZIP extracts correctly
  - [ ] Verify plugin activates without errors

- [ ] Task 9: Write staging deployment documentation (AC: 3)
  - [ ] Document staging environment requirements
  - [ ] Write step-by-step staging deployment process
  - [ ] Step 1: Backup current staging site
  - [ ] Step 2: Upload plugin ZIP via WP admin or FTP
  - [ ] Step 3: Activate plugin
  - [ ] Step 4: Configure settings (API key, defaults)
  - [ ] Step 5: Import test data (CSV or manual)
  - [ ] Step 6: Run post-deployment tests (checklist)
  - [ ] Document expected staging test duration
  - [ ] Document stakeholder review process
  - [ ] Create docs/deployment/staging-deployment.md

- [ ] Task 10: Write production deployment documentation (AC: 3)
  - [ ] Document production environment requirements
  - [ ] Write step-by-step production deployment process
  - [ ] Step 1: Schedule maintenance window
  - [ ] Step 2: Notify users of downtime (if any)
  - [ ] Step 3: Backup production site (database and files)
  - [ ] Step 4: Upload plugin ZIP
  - [ ] Step 5: Activate plugin
  - [ ] Step 6: Configure settings (production API key)
  - [ ] Step 7: Test critical workflows (generate, edit, publish)
  - [ ] Step 8: Monitor for 24 hours (errors, performance)
  - [ ] Document rollback trigger criteria
  - [ ] Create docs/deployment/production-deployment.md

- [ ] Task 11: Write rollback procedure (AC: 3)
  - [ ] Document rollback decision criteria
  - [ ] Write step-by-step rollback process
  - [ ] Step 1: Deactivate plugin via WP admin or database
  - [ ] Step 2: Restore from backup (if database changes)
  - [ ] Step 3: Verify site functionality restored
  - [ ] Step 4: Document rollback reason
  - [ ] Step 5: Notify stakeholders
  - [ ] Document data loss implications (generation logs)
  - [ ] Document user communication plan
  - [ ] Create docs/deployment/rollback-procedure.md

- [ ] Task 12: Create post-deployment testing checklist (AC: 3)
  - [ ] Create comprehensive post-deploy test checklist
  - [ ] Test: Plugin activated successfully
  - [ ] Test: Settings page loads
  - [ ] Test: API key saves and encrypts
  - [ ] Test: Generate single block
  - [ ] Test: Generate all blocks (full page)
  - [ ] Test: CSV import
  - [ ] Test: Image library upload and tagging
  - [ ] Test: Frontend page displays correctly
  - [ ] Test: No PHP errors in debug log
  - [ ] Test: No JavaScript console errors
  - [ ] Test: Cost tracking records generation
  - [ ] Test: Analytics displays correctly
  - [ ] Document expected test duration (30-45 minutes)
  - [ ] Create docs/deployment/post-deployment-checklist.md

- [ ] Task 13: Create CHANGELOG.md (AC: 1)
  - [ ] Create CHANGELOG.md file
  - [ ] Document version 1.0.0 release
  - [ ] List all features (12 block generation, image library, CSV import)
  - [ ] List all major components (OpenAI integration, ACF fields, REST API)
  - [ ] Use Keep a Changelog format
  - [ ] Add release date
  - [ ] Link to PRD and architecture docs

- [ ] Task 14: Final deployment package validation (AC: 1, 2, 4)
  - [ ] Verify version numbers consistent (1.0.0)
  - [ ] Verify ZIP package created
  - [ ] Test ZIP on fresh WordPress install
  - [ ] Verify all assets load correctly
  - [ ] Verify plugin icon displays
  - [ ] Verify readme.txt displays correctly
  - [ ] Run final PHPCS check
  - [ ] Run final security scan
  - [ ] Verify no debug code or console.logs
  - [ ] Get stakeholder approval for deployment
  - [ ] Tag release in Git (v1.0.0)
  - [ ] Create GitHub release with ZIP attachment

## Dev Notes

### Pre-Launch Checklist from Epic

**Must Complete Before Deployment:**
- [ ] Code follows WordPress standards
- [ ] No PHP errors/warnings
- [ ] Security review complete
- [ ] All tests passing
- [ ] Documentation complete
- [ ] Plugin icon created
- [ ] Screenshots prepared
- [ ] readme.txt formatted
[Source: Epic epic-7-testing-polish.md#story-7.9]

### WordPress.org Plugin Requirements

**Plugin Header Requirements:**
```php
/**
 * Plugin Name: SEO Content Generator
 * Plugin URI: https://example.com/seo-content-generator
 * Description: AI-powered SEO content generator for jewelry e-commerce using OpenAI GPT-4
 * Version: 1.0.0
 * Requires at least: 6.0
 * Requires PHP: 8.0
 * Author: Your Name
 * Author URI: https://example.com
 * License: GPL v2 or later
 * License URI: https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain: seo-content-generator
 * Domain Path: /languages
 */
```
[Source: Architecture architecture.md#plugin-architecture]

**readme.txt Format:**
```
=== SEO Content Generator ===
Contributors: yourusername
Tags: seo, content-generator, ai, openai, acf
Requires at least: 6.0
Tested up to: 6.4
Requires PHP: 8.0
Stable tag: 1.0.0
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html

Short description here.

== Description ==
Full description...

== Installation ==
Installation steps...

== Frequently Asked Questions ==
FAQs...

== Screenshots ==
1. Screenshot 1 description
2. Screenshot 2 description

== Changelog ==
= 1.0.0 =
* Initial release
```
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Build Script Requirements

**Files to Include in ZIP:**
- All PHP files (includes/, templates/, languages/)
- Compiled assets (assets/js/build/, assets/css/)
- Composer vendor/ (production only, --no-dev)
- ACF JSON definitions (acf-json/)
- Plugin header file (content-generator.php)
- readme.txt, LICENSE.txt
- Icon and screenshots

**Files to Exclude:**
- .git, .github
- node_modules/
- tests/
- src/ (source JS/CSS)
- package.json, package-lock.json
- composer.json, composer.lock
- webpack.config.js
- .env, .editorconfig, .eslintrc.js, .phpcs.xml.dist
- Development docs (keep user docs)
[Source: Epic epic-7-testing-polish.md#story-7.9]

**Example Build Script (package.json):**
```json
{
  "scripts": {
    "build": "webpack --mode production",
    "build:plugin": "bash build.sh"
  }
}
```

**Example build.sh:**
```bash
#!/bin/bash

# Clean dist directory
rm -rf dist
mkdir dist

# Install production dependencies
composer install --no-dev --optimize-autoloader

# Build assets
npm run build

# Copy files
rsync -av --exclude-from='.distignore' . dist/content-generator/

# Create ZIP
cd dist
zip -r content-generator-1.0.0.zip content-generator/
cd ..

echo "Build complete: dist/content-generator-1.0.0.zip"
```
[Source: Architecture architecture.md#development-workflow]

### Deployment Environments

**Staging Requirements:**
- WordPress 6.0+ with similar configuration to production
- OpenAI test API key (separate from production)
- Test data (sample pages, images)
- Monitoring enabled (debug log, error reporting)

**Production Requirements:**
- WordPress 6.0+ on stable hosting
- HTTPS enabled (required for OpenAI API)
- PHP 8.0+, 256MB memory, 300s execution time
- Production OpenAI API key
- Backup solution in place
- Monitoring/alerting configured
[Source: PRD prd.md#technical-requirements]

### Version Numbering

**Semantic Versioning:**
- Major.Minor.Patch (e.g., 1.0.0)
- Version 1.0.0 for initial release
- Increment patch for bug fixes (1.0.1)
- Increment minor for new features (1.1.0)
- Increment major for breaking changes (2.0.0)

**Where to Set Version:**
1. Main plugin file header (Version: 1.0.0)
2. package.json ("version": "1.0.0")
3. composer.json ("version": "1.0.0")
4. readme.txt (Stable tag: 1.0.0)
5. Plugin class constant (const VERSION = '1.0.0')
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Rollback Scenarios

**When to Rollback:**
- Critical bugs discovered in production
- Security vulnerabilities found
- Performance degradation (site slowdown)
- Database corruption or data loss
- Third-party API failures (OpenAI)
- User-facing errors preventing work

**Rollback Methods:**
1. Deactivate plugin via WordPress admin
2. Rename plugin folder via FTP/SSH
3. Use WP-CLI: `wp plugin deactivate content-generator`
4. Database query: `UPDATE wp_options SET option_value = '' WHERE option_name = 'active_plugins'`
5. Restore from backup if database changes made
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Post-Deployment Monitoring

**First 24 Hours:**
- Monitor error logs (debug.log)
- Monitor OpenAI API usage and costs
- Monitor user feedback/support tickets
- Monitor performance (page load times)
- Monitor database query performance
- Check for JavaScript console errors

**First Week:**
- Review generation success rates
- Review cost per page averages
- Review user adoption metrics
- Check for compatibility issues
- Monitor for security issues
[Source: Epic epic-7-testing-polish.md#deployment]

### Documentation Structure

**Deployment Docs to Create:**
- `docs/deployment/staging-deployment.md`
- `docs/deployment/production-deployment.md`
- `docs/deployment/rollback-procedure.md`
- `docs/deployment/post-deployment-checklist.md`
- `CHANGELOG.md` (root directory)

**Existing Docs to Verify Complete:**
- `README.md` (plugin overview)
- `docs/user-guide.md` (Story 7.6)
- `docs/developer-guide.md` (Story 7.7)
- `docs/architecture.md` (architecture)
- `docs/prd.md` (requirements)
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Plugin Icon and Screenshots

**Icon Specs:**
- 512x512 PNG or SVG
- 256x256 for retina displays
- 128x128 for standard displays
- Simple, recognizable design
- Use brand colors
- Filenames: icon-256x256.png, icon-128x128.png

**Screenshot Specs:**
- 1200x900 PNG (4:3 ratio)
- 1280x960 for retina (optional)
- Number sequentially: screenshot-1.png, screenshot-2.png, etc.
- Annotate with arrows/highlights if helpful
- Show key features and interfaces
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Testing the Distribution Package

**Fresh Install Test:**
1. Set up clean WordPress 6.0+ install
2. Install ACF Free plugin
3. Upload plugin ZIP via admin
4. Activate plugin
5. Configure settings (test API key)
6. Create first SEO page
7. Generate content
8. Verify all features work
9. Check for errors in debug log

**Upgrade Test (if applicable):**
1. Install previous version
2. Create test data
3. Upload new version ZIP
4. Activate/update plugin
5. Verify data preserved
6. Verify new features available
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Final Release Checklist

- [ ] All Epic 7 stories complete (7.1-7.8)
- [ ] All tests passing
- [ ] Documentation complete
- [ ] Security audit passed
- [ ] Performance benchmarks met
- [ ] Version numbers set to 1.0.0
- [ ] Plugin icon created
- [ ] Screenshots captured
- [ ] readme.txt formatted
- [ ] Distribution ZIP created
- [ ] ZIP tested on fresh install
- [ ] Deployment docs written
- [ ] Rollback procedure documented
- [ ] Post-deployment checklist created
- [ ] CHANGELOG.md created
- [ ] Git tag created (v1.0.0)
- [ ] GitHub release published
- [ ] Stakeholder approval obtained
[Source: Epic epic-7-testing-polish.md#story-7.9]

### Testing

**Distribution Package Testing:**
- Test ZIP extracts correctly
- Test plugin activates without errors
- Test all features work with compiled assets
- Test with WP_DEBUG enabled (no errors)
- Test icon displays in plugins list
- Test screenshots display in plugin page

**Deployment Documentation Testing:**
- Follow staging deployment docs step-by-step
- Time each deployment step
- Verify all steps accurate
- Get feedback from non-developer
- Follow rollback procedure to verify accuracy

**Post-Deployment Checklist Testing:**
- Run through entire checklist on staging
- Verify all tests complete successfully
- Time checklist completion
- Refine checklist based on experience
[Source: Epic epic-7-testing-polish.md#story-7.9]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

## QA Results

*This section will be populated by QA Agent after story completion*
