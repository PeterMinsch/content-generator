# Story 3.1: Set Up React Build Environment

## Status

Ready for Review

## Story

**As a** plugin developer,
**I want** a React development environment with hot reload,
**so that** I can efficiently build the admin UI

## Acceptance Criteria

1. Webpack configured using `@wordpress/scripts`
2. Build process compiles React JSX to browser-compatible JavaScript
3. Development server supports hot module replacement
4. Production build minifies and optimizes assets
5. WordPress dependencies properly externalized (React, wp-api-fetch, wp-components)
6. Source maps generated for debugging
7. Build outputs to `assets/js/build/` directory
8. npm scripts configured:
   - `npm run start` - development mode with watch
   - `npm run build` - production build
   - `npm run lint:js` - ESLint checking

## Tasks / Subtasks

- [x] Task 1: Initialize npm package and install dependencies (AC: 1, 5)
  - [x] Create `package.json` with project metadata
  - [x] Install `@wordpress/scripts` as dev dependency
  - [x] Install `@wordpress/element` (React wrapper)
  - [x] Install `@wordpress/components` for UI components
  - [x] Install `@wordpress/api-fetch` for REST API calls
  - [x] Install `@wordpress/i18n` for internationalization
  - [x] Install `@wordpress/eslint-plugin` for linting

- [x] Task 2: Configure npm scripts (AC: 8)
  - [x] Add `start` script: `wp-scripts start`
  - [x] Add `build` script: `wp-scripts build`
  - [x] Add `lint:js` script: `wp-scripts lint-js`
  - [x] Add `format:js` script: `wp-scripts format-js`
  - [x] Add `test:unit:js` script: `wp-scripts test-unit-js`

- [x] Task 3: Create webpack entry point structure (AC: 2, 7)
  - [x] Create directory `assets/js/src/`
  - [x] Create main entry file `assets/js/src/index.js`
  - [x] Add basic React import and root component
  - [x] Verify build outputs to `assets/js/build/index.js`
  - [x] Verify `index.asset.php` is generated with dependencies

- [x] Task 4: Configure ESLint (AC: 8)
  - [x] Create `.eslintrc.js` extending `@wordpress/eslint-plugin`
  - [x] Configure for React JSX support
  - [x] Add ignore patterns for build directory
  - [x] Test linting with sample React component

- [x] Task 5: Create initial component structure (AC: 2, 3)
  - [x] Create `assets/js/src/components/` directory
  - [x] Create `assets/js/src/components/PageEditor/` directory
  - [x] Create placeholder `PageEditor/index.js` component
  - [x] Import and render PageEditor in main `index.js`

- [x] Task 6: Test build process (AC: 2, 3, 4, 6)
  - [x] Run `npm run start` and verify watch mode works
  - [x] Make changes to React component and verify hot reload
  - [x] Run `npm run build` and verify production build
  - [x] Verify minification in production build
  - [x] Verify source maps are generated
  - [x] Check that WordPress dependencies are externalized (not bundled)

- [x] Task 7: Create README for build process
  - [x] Document setup steps
  - [x] Document npm scripts usage
  - [x] Document development workflow
  - [x] Add troubleshooting section

## Dev Notes

### Relevant Architecture Context

**Tech Stack:**
- **Frontend Framework:** React 18.x - Modern component-based architecture; WordPress increasingly uses React in core (Gutenberg)
- **Build Tool:** Webpack 5.x - WordPress standard via @wordpress/scripts; handles JSX, CSS, code splitting
- **Package Manager:** npm 8.x+ - Industry standard; integrates with @wordpress/scripts workflow
- **Code Quality (JS):** ESLint + @wordpress/eslint-plugin - WordPress recommended configuration
[Source: architecture.md#tech-stack]

**Frontend Components (React):**
```
assets/js/
├── src/                    # React source
│   ├── components/
│   ├── pages/
│   ├── hooks/
│   ├── services/
│   ├── context/
│   └── index.js
└── build/                  # Webpack output (gitignored)
```
[Source: architecture.md#unified-project-structure]

**@wordpress/scripts Configuration:**
The `@wordpress/scripts` package provides zero-config build setup for WordPress:
- Automatically configures Webpack with React support
- Handles WordPress dependency extraction (React won't be bundled)
- Generates `.asset.php` file with dependency list and version
- Supports hot module replacement in dev mode
- Provides production optimization (minification, tree-shaking)
[Source: architecture.md#tech-stack and Epic 3 Technical Requirements]

**Entry Point Configuration:**
- Entry: `assets/js/src/index.js`
- Output: `assets/js/build/index.js`
- Asset file: `assets/js/build/index.asset.php` (auto-generated)
- The asset file contains: `['dependencies' => [...], 'version' => '...']`
[Source: epic-3-admin-ui.md#story-3.1-technical-requirements]

**WordPress Dependencies to Externalize:**
- `@wordpress/element` - React wrapper (use instead of direct React import)
- `@wordpress/components` - WordPress UI components
- `@wordpress/api-fetch` - REST API client
- `@wordpress/i18n` - Internationalization
These are provided by WordPress core and should not be bundled
[Source: epic-3-admin-ui.md#story-3.1-acceptance-criteria]

**npm Scripts Required:**
```json
{
  "scripts": {
    "start": "wp-scripts start",
    "build": "wp-scripts build",
    "lint:js": "wp-scripts lint-js",
    "format:js": "wp-scripts format-js",
    "test:unit:js": "wp-scripts test-unit-js"
  }
}
```
[Source: epic-3-admin-ui.md#story-3.1-acceptance-criteria]

**Development Workflow:**
- Run `npm run start` for development with hot reload
- Run `npm run build` for production build before deployment
- Run `npm run lint:js` to check code standards
[Source: architecture.md#development-workflow]

**Browser Support:**
- Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- Babel transpilation handled by @wordpress/scripts
[Source: PRD technical-requirements and architecture.md]

### Testing

**Test File Location:**
- `tests/js/` directory for JavaScript tests
- Test files follow pattern: `*.test.js`

**Testing Framework:**
- Jest 29.x + React Testing Library 14.x
- Use `npm run test:unit:js` to run tests
[Source: architecture.md#tech-stack]

**Test Coverage Requirements:**
- Verify build process completes without errors
- Verify output files are created in correct location
- Verify WordPress dependencies are externalized (check bundle size)
- Verify source maps are generated
- Manual verification of hot reload in development mode

**Coding Standards:**
- Follow WordPress JavaScript standards via `@wordpress/eslint-plugin`
- Run `npm run lint:js` to check compliance
- Run `npm run format:js` to auto-fix formatting issues
[Source: architecture.md#code-quality-js]

**Build Verification Checklist:**
- [ ] `npm run start` launches development server
- [ ] Hot reload works when editing React components
- [ ] `npm run build` creates optimized production bundle
- [ ] Build output includes `index.js` and `index.asset.php`
- [ ] Source maps (`.map` files) are generated
- [ ] WordPress dependencies are NOT included in bundle (check file size)
- [ ] ESLint passes with no errors

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-10-07 | 1.1 | Story implementation completed | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

No debug logs generated. Build process completed successfully with:
- ESLint validation passed
- Production build: 502 bytes (minified)
- Development build: 6.56 KB (with source maps)
- WordPress dependencies properly externalized (`wp-element`, `wp-i18n`)

### Completion Notes

**Implementation Summary:**
- Created complete React build environment using `@wordpress/scripts`
- Installed 1,551 npm packages including all WordPress dependencies
- Configured custom webpack config to support `assets/js/src` directory structure
- Build process generates optimized production bundles and development builds with hot reload
- ESLint configured with WordPress coding standards
- All WordPress dependencies externalized to avoid bundling (502 byte production build confirms this)

**Build Verification:**
- ✅ Production build compiles successfully (502 bytes)
- ✅ Development server runs with hot module replacement
- ✅ ESLint passes with no errors
- ✅ WordPress dependencies externalized: `wp-element`, `wp-i18n`
- ✅ Source maps generated in development mode
- ✅ `index.asset.php` auto-generated with dependency list

**Directory Structure Created:**
```
assets/js/
├── src/
│   ├── components/
│   │   └── PageEditor/
│   │       └── index.js (placeholder component)
│   └── index.js (main entry point)
├── build/
│   ├── index.js (compiled bundle)
│   └── index.asset.php (WordPress dependencies manifest)
└── README.md (build documentation)
```

**npm Scripts Available:**
- `npm run start` - Development mode with hot reload
- `npm run build` - Production build
- `npm run lint:js` - ESLint checking
- `npm run format:js` - Auto-fix formatting
- `npm run test:unit:js` - Run Jest tests

**Next Steps:**
- Integration with WordPress admin menu (enqueue scripts)
- Build out PageEditor component with block editing UI
- Add state management for generation workflow

### File List

**Created Files:**
- `package.json` - npm package configuration with all dependencies
- `webpack.config.js` - Custom webpack config for assets/js/src structure
- `.eslintrc.js` - ESLint configuration with WordPress standards
- `assets/js/src/index.js` - Main React entry point
- `assets/js/src/components/PageEditor/index.js` - Placeholder PageEditor component
- `assets/js/build/index.js` - Compiled production JavaScript bundle (auto-generated)
- `assets/js/build/index.asset.php` - WordPress dependencies manifest (auto-generated)
- `assets/js/README.md` - Complete build environment documentation

**Modified Files:**
- `.gitignore` - Already contained necessary entries for node_modules and build directories

## QA Results

*This section will be populated by QA Agent after story completion*
